[platformio]
default_envs = esp32-wroom-32

[env:esp32-wroom-32]
platform = espressif32@^6.3.0
board = esp32dev
framework = arduino
monitor_speed = 115200
monitor_rts = 0
monitor_dtr = 0
upload_speed = 460800
; Try slower speeds if upload fails: 230400, 115200, 921600
upload_flags = 
    --before=default_reset
    --after=hard_reset

# Flash settings - fix "invalid header" errors
board_build.flash_mode = dio
board_build.freq = 40m
board_build.flash_size = 4MB
board_build.partitions = default.csv
# upload_port = COM3  # Auto-detect port (commented out for automatic detection)
                     # PlatformIO will automatically find the ESP32 port
                     # If needed, uncomment and set manually: pio device list  
# Library dependencies
lib_deps = 
    bblanchon/ArduinoJson @ ^6.21.3
    tzapu/WiFiManager@^2.0.17
    bodmer/TFT_eSPI@^2.5.0
    # ArduinoOTA is built into ESP32 Arduino Core
# Build flags for optimization and debugging
# Reduced debug levels to save flash memory (~5-10KB saved)
build_flags = 
    -DCORE_DEBUG_LEVEL=0
    -DARDUINO_USB_CDC_ON_BOOT=0
    -DARDUINO_USB_MODE=0
    -DSERIAL_DEBUG=0
    -DUSBCDC_ENABLED=0
    -DCONFIG_ARDUHAL_LOG_COLORS=0
    -DCONFIG_LOG_DEFAULT_LEVEL_WARN=1
    -DCONFIG_ESP32_DEFAULT_CPU_FREQ_240=1
    -DCONFIG_FREERTOS_HZ=1000
    # Disabled FreeRTOS tracing features to save flash (~3-5KB saved)
    # -DCONFIG_FREERTOS_USE_TRACE_FACILITY=1
    # -DCONFIG_FREERTOS_USE_STATS_FORMATTING_FUNCTIONS=1
    # -DCONFIG_FREERTOS_GENERATE_RUN_TIME_STATS=1
    # -DCONFIG_FREERTOS_USE_IDLE_HOOK=1
    # -DCONFIG_FREERTOS_USE_TICK_HOOK=1
    # Power management - Brown-out detector settings
    # Note: Removed override to avoid conflicts with SDK defaults
    # If you need to disable BOD, configure via menuconfig or sdkconfig

# Monitor filters for better debugging
monitor_filters = 
    esp32_exception_decoder
    time
